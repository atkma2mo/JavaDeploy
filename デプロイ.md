Welcome to the JavaDeploy wiki!  

# 制作中なので見ないでください（笑）

# JavaDeploy  


Jenkins CircleCIなどは使いません。学内サーバへのデプロイ手順を説明します。クラウドの話もでません。



## サーバセキュリティの設定(最低限)  


セキュリティについては必要なものを吟味してください。  

  

Debian環境で進めます。

Debian 

https://www.rem-system.com/debian10-first-settings/  


https://www.server-world.info/query?os=Debian_10  


http://archiva.jp/web/server-side/debian-setup.html    


CentOS前半部分  

https://qiita.com/tadatti/items/9f4911c624aafba63258  



## 初期インストールされたパッケージをアップデート  


```$ apt update``` 　　


```$ apt upgrade```  
   

```$ su```  
でrootログイン。パスワードが求められるのでログインする。  
 

```Password:```  
でrootのパスワードを入力する。  


rootユーザから一般ユーザへの切り替え  
```#exit```  
実行するとプロンプトが$に変わるのを確認する。  

## vim backspaceを使えるようにする。  


「.vimrc」ファイルに  

```set backspace=indent,eol,start```  


## デフォルトのvimの使いかた  

Escを押したあと、xで文字を消す。  
a、iで挿入モード  
oで改行  
ddで行の削除  

# Openjdk11 maven h2DB nginxをインストール  

前提条件  
Debianシステムにパッケージをインストールできるようにするには、sudo特権を持つユーザーとしてログインする必要があります。  

```$ su```    


パッケージの更新  

```$ apt install ```  


インストール時にはtmpファイルで行ってあとで消せるようにする。  

```cd /tmp```  



## Openjdk11のインストール  

資料のOpenjdk8を11にする。


OpenJDK11のインストールをする。  
```# apt install openjdk-11-jdk```    

システムに複数のJavaバージョンがインストールされている場合は、次のコマンドを使用してバージョンを切り替えます。  

```# update-alternatives --config java```  

システムが正しいJDKを使用していることを確認します。  

```# java -version```  
 

zuluとか使わないほうがいい。    
default-jdkも誤作動あるかもなのでフルパスで指定。  


Openjdkサイト  
https://openjdk.java.net/  

## Apache mavenのインストール 

今なら3.6.3(2019/12/06現在)  

Mavenをインストール
```# apt install maven ```  

[Y/n]でYを入力し、Enter  

  

環境変数に設定されているパスを表示する。  



メモする。

```# echo JAVA_HOME```  

```# echo M2_HOME```   

```# echo MAVEN_HOME```  
  

環境変数のセットアップ    

```# vi /etc/profile.d/maven.sh```  

  
```
export JAVA_HOME=[echoしたJAVA_HOME] 
export M2_HOME=[echoしたM2_HOME]  
export MAVEN_HOME=[echoしたMAVEN_HOME]  
export PATH=${M2_HOME}/bin:${PATH}   
```  

ファイルを保存して閉じます。  
```:wq!```  

chmodコマンドを入力して、スクリプトを実行可能にします。  

```# chmod +x /etc/profile.d/maven.sh```  

sourceコマンドを使用して環境変数をロードする。

```# source /etc/profile.d/maven.sh```  


mavenインストールの確認  

```# mvn -version```  



mavenダウンロードページ  
https://maven.apache.org/download.cgi   




## h2DBのインストール  

h2DBはPureJavaのため事前にjdkのインストールが必要です。先ほどインストールしたので大丈夫です。    

```# wget http://www.h2database.com/h2-2017-03-10.zip```  

2019/12/06現在  

```# unzip h2-2019-10-14.zip```  

```# cd h2```  

webAllowOthers=trueはremote connectionを有効にするための設定  

```# echo webAllowOthers=true > ~/.h2.server.properties```  

```# java -jar bin/h2-1.4.194.jar```  

## アクセス  

http://localhost:8282にアクセスするとログイン画面がでる。  

JDBC:URLに  

```jdbc:h2:tcp://localhost/~/データベース名```  

と入力して接続テストを行い、successとなれば接続する。  

 

SQLを流してテーブル作成。  


h2DBの設定方法  
http://yoks.blue.coocan.jp/TechNote/H2/H2_ope2.htm  


h2DB公式  
http://www.h2database.com/html/tutorial.html#console_settings 
 　　

## nginxのインストール  

```# apt install nginx```  


インストールの確認  
```# nginx -v```

https://www.mk-mode.com/blog/2017/09/16/debian-9-nginx-installation-by-official-apt/  

https://qiita.com/lookung4/items/82c82ba8f152408e6f77  


https://shioleap.github.io/blog/Linux/Debian/install-nginx/  

https://def-4.com/nginx-php7-mariadb/  


https://github.com/hironomiu/Local-Development-Environment-Hands-On/blob/master/Step2.md  



nginx公式  
https://nginx.org/en/


# scpコマンドでデプロイ  


理想はshellscript書いて自動化ができれば…  


